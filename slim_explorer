#!/usr/bin/env ruby

# frozen_string_literal: true

require_relative 'lib/data'
require_relative 'lib/loop'
require_relative 'lib/warn'

def explorer
  SlimExplorer
    .new(
      output_directory: 'www',
      watched_directory: 'watched',
      slim_template: 'template.slim',
      yaml_file: 'scope.yaml'
    )
    .with_env_vars # Delete this line if you do not want environment name/value pairs in the data
    .with_properties('rabbit': 'bugs bunny')  # Extra tuple just for fun
end

def serve
  explorer.explore
  pid = spawn('thin start -C config/thin.yaml')
rescue StandardError
  Process.kill('QUIT', pid)
end

def command_line
  explorer.explore
end

case ARGV[1]
when nil
  command_line
when 'serve'
  serve
else
  puts "#{ARGV[1]} is not a recognized action"
end
